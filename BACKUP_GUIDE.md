# バックアップ・復元機能 使用ガイド

## 📦 バックアップ機能の概要

データベースのバックアップと復元機能により、データの安全性を確保できます。

## 🎯 主な機能

### 1. バックアップの作成
- ワンクリックでデータベース全体をバックアップ
- ファイル名に日時が自動付与（例: `inventory_backup_20260201_143025.db`）
- `backups/` フォルダに保存

### 2. バックアップの管理
- 作成済みバックアップの一覧表示
- 各バックアップのサイズと作成日時を確認
- バックアップ統計（総数、合計サイズ、最新日時）

### 3. バックアップからの復元
- 選択したバックアップからデータを復元
- **安全機能**: 復元実行前に現在のDBを自動バックアップ
- 復元は元に戻せないため、確認ダイアログで慎重に実行

### 4. バックアップのダウンロード
- バックアップファイルをローカルにダウンロード
- 外部ストレージへの保管が可能

### 5. バックアップの削除
- 不要なバックアップファイルを削除
- 容量管理に便利

## 📍 アクセス方法

### メインメニューから
1. トップページの「バックアップ」ボタンをクリック
2. または `/backup` にアクセス

### ダッシュボードから
1. ダッシュボードのクイックアクションから「バックアップ」を選択

## 🔧 使い方

### バックアップの作成手順
1. バックアップ管理ページにアクセス
2. 「バックアップを作成」ボタンをクリック
3. 確認ダイアログで「OK」を選択
4. バックアップが作成され、一覧に表示されます

### バックアップからの復元手順
1. バックアップ一覧から復元したいファイルを選択
2. 「復元」ボタン（↻ アイコン）をクリック
3. **重要な警告を確認**:
   - 現在のデータは上書きされます
   - 復元前の自動バックアップが作成されます
4. 「OK」で復元を実行
5. データが復元されます

### バックアップのダウンロード手順
1. バックアップ一覧からダウンロードしたいファイルを選択
2. 「ダウンロード」ボタン（⬇ アイコン）をクリック
3. ファイルが保存されます

### バックアップの削除手順
1. バックアップ一覧から削除したいファイルを選択
2. 「削除」ボタン（🗑 アイコン）をクリック
3. 確認ダイアログで「OK」を選択
4. バックアップが削除されます

## ⚠️ 重要な注意事項

### バックアップについて
- 定期的なバックアップを推奨（週次または重要な作業前）
- バックアップファイルは機密データを含むため、適切に管理してください
- サーバーの容量を考慮し、古いバックアップは定期的に削除

### 復元について
- **復元は元に戻せません**
- 復元前に自動バックアップが作成されますが、重要な場合は手動でもバックアップを作成
- 復元後はアプリケーションを再起動することを推奨

### セキュリティ
- バックアップファイルには全データが含まれます
- 重要なバックアップは外部の安全な場所に保管
- 本番環境ではアクセス制限を設定

## 📊 バックアップファイルの命名規則

```
inventory_backup_YYYYMMDD_HHMMSS.db
```

例:
- `inventory_backup_20260201_143025.db` 
  → 2026年2月1日 14:30:25 に作成

## 🔄 推奨バックアップスケジュール

### 最小限
- 重要な作業（大量データ入力、設定変更など）の前

### 推奨
- 週次: 毎週決まった曜日にバックアップ
- 月次: 月初にバックアップ
- 作業前: 重要な作業の前

### 理想
- 日次: 毎日の業務終了時
- 作業前: 重要な作業の前
- 外部保管: 週次で外部ストレージに保管

## 💾 ストレージ管理

### バックアップファイルのサイズ
- データ量により異なりますが、通常は数KB〜数MB
- バックアップ統計で合計サイズを確認可能

### 容量節約のヒント
1. 古いバックアップ（3ヶ月以上前）は削除
2. 重要なバックアップのみ外部に保管し、サーバーから削除
3. 月次バックアップは長期保管、週次は短期保管

## 🛠 トラブルシューティング

### バックアップの作成に失敗
- データベースファイルが存在することを確認
- `instance/inventory.db` へのアクセス権限を確認
- ディスク容量を確認

### 復元に失敗
- バックアップファイルが破損していないか確認
- データベースファイルへの書き込み権限を確認
- 復元後、アプリケーションを再起動

### バックアップが表示されない
- `backups/` フォルダが存在することを確認
- フォルダへのアクセス権限を確認

## 📁 ファイル構造

```
在庫管理/
├── instance/
│   └── inventory.db              # 現在のデータベース
├── backups/                       # バックアップ保存先
│   ├── inventory_backup_20260201_143025.db
│   ├── inventory_backup_20260208_143030.db
│   └── ...
└── instance/
    └── inventory_before_restore_YYYYMMDD_HHMMSS.db  # 復元時の自動バックアップ
```

## 🔐 セキュリティベストプラクティス

1. **アクセス制限**
   - バックアップ管理ページへのアクセスを制限
   - 本番環境では認証機能を追加することを推奨

2. **バックアップの暗号化**
   - 機密性の高いデータの場合、バックアップファイルを暗号化

3. **外部保管**
   - 重要なバックアップは複数の場所に保管
   - クラウドストレージの活用を検討

4. **定期確認**
   - バックアップからの復元が正常に動作するか定期的にテスト

## 📞 サポート

問題が発生した場合は、以下を確認してください：
- エラーメッセージの内容
- 実行した操作の詳細
- バックアップファイルのサイズと日時
- システムのディスク容量
