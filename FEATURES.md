# 在庫管理システム - 新機能説明

## レシピ機能 (Recipe System)

### 概要
複数の原料を組み合わせた「レシピ」を作成し、保存して再利用できる機能です。

### 主な機能

#### 1. レシピの作成
- レシピ名と説明を入力
- 複数の原料とその使用量を指定
- 各原料にロット名を任意で指定可能
- 例: 「試作品A用配合」というレシピに、原料1を100g、原料2を50gなど

#### 2. レシピの管理
- レシピ一覧の表示
- レシピの編集・削除
- レシピに含まれる原料の一覧表示

#### 3. レシピから使用予約を作成
- 保存したレシピを選択して、ワンクリックで使用予約を作成
- 使用者名、使用目的、使用予定日を入力可能
- レシピに含まれる全ての原料に対して自動的に使用予約が作成される

## 使用予約の拡張機能

### 追加された項目

#### 1. 使用者名 (User Name)
- 原料を使用する人の名前を任意で入力
- 例: 「山田太郎」

#### 2. 使用目的 (Purpose)
- 何のために使用するかを任意で入力
- 例: 「試作品A」「品質試験」など

#### 3. 実際の量 (Actual Quantity)
- 予約量と実際に使用した量が異なる場合に記録
- 予約: 100g、実際: 95g など
- 任意入力

#### 4. レシピ連携
- レシピから作成された予約には、どのレシピから作成されたかが記録される
- 予約一覧画面でレシピ名が表示される

## 使い方

### レシピを作成する
1. メイン画面から「レシピ管理」ボタンをクリック
2. 「新規レシピ登録」をクリック
3. レシピ名と説明を入力
4. 使用する各原料の量を入力（使用しない原料は空欄のまま）
5. 必要に応じてロット名を入力
6. 「Save Recipe」をクリック

### レシピから使用予約を作成する
1. レシピ管理画面でレシピを表示
2. 「使用予約作成」ボタンをクリック
3. モーダルダイアログで以下を入力:
   - 使用者名（任意）
   - 使用目的（任意）
   - 使用予定日（任意）
4. 「使用予約作成」をクリック
5. レシピに含まれる全原料の使用予約が一括作成される

### 使用予約を個別に作成する（従来の方法）
1. 原料一覧から「使用予約」ボタンをクリック
2. 以下を入力:
   - 既存ロット選択（任意）
   - 新規ロット名（任意）
   - 数量（必須）
   - 実際の量（任意）
   - 使用者名（任意）
   - 使用目的（任意）
   - 使用予定日（任意）
3. 「Reserve」をクリック

## データベース変更点

### Reservationテーブルに追加されたカラム
- `recipe_id`: レシピID（どのレシピから作成されたか）
- `actual_quantity`: 実際の使用量
- `user_name`: 使用者名
- `purpose`: 使用目的

### 新しいテーブル
- `recipe`: レシピ情報を保存
  - id, name, description, type, date_created
- `recipe_item`: レシピに含まれる原料情報
  - id, recipe_id, material_id, quantity, lot_name

## 画面遷移
```
原料一覧 (index)
├── レシピ管理 (recipes)
│   ├── 新規レシピ登録 (add_recipe)
│   ├── レシピ編集 (edit_recipe)
│   └── レシピから使用予約作成 (use_recipe) → 予約管理へ
├── 予約管理 (reservations)
│   └── 使用予約・補充予約の一覧と管理
└── 使用予約 (reserve_use)
    └── 個別の原料に対する使用予約作成
```

## 注意事項
- レシピを削除すると、そのレシピに含まれる原料情報（recipe_item）も削除されます
- レシピから作成された予約を削除しても、レシピ自体は削除されません
- 実際の量（actual_quantity）は記録用で、在庫計算には予約量（quantity）が使用されます
